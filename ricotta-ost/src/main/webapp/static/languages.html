<div class="languages">
	<table id="languages" class="table table-striped table-bordered">
	    <thead>
	        <tr>
	            <th>Code</th><th>Name</th>
	        </tr>
	    </thead>
	    <tbody id="languagesBody"></tbody>
	    <tfoot>
	    </tfoot>
	</table>
	<a data-toggle="modal" href="#createLanguageDialog" class="btn btn-primary">Create new language...</a>
	<!-- 
	<button id="createLanguageButton" >Create new language...</button> -->
	<div id="createLanguageDialog"  class="modal hide fade in" style="display: none;">
		<div class="modal-header">  
			<a class="close" data-dismiss="modal">Ã—</a>
			<h3>Create new language</h3>
		</div> 
		<div class="modal-body">
			 <p class="validateTips"></p>
		    <form>
		        <fieldset>
		            <label for="langCode">Language code</label>
		            <input id="langCode" name="langCode"  class="text ui-widget-content ui-corner-all" />
		            <label for="langName">Language name</label>
		            <input id="langName" name="langName"  class="text ui-widget-content ui-corner-all" />
		        </fieldset>
		    </form>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn btn-success">Create Project</a>
			<a href="#" class="btn" data-dismiss="modal">Cancel</a>
		</div>
	    
	</div>
	
	<script type="text/javascript">
	
	function populateLanguages(data) {
	    $("#languagesBody").empty();
	    $.map(data, function(p, i) {
	        $("#languagesBody")
	            .append("<tr><td>" + p.code + "</td>" +
	                "<td>" + p.name + "</td>" +
	                "</tr>");
	    });
	}
	
	function loadLanguages() {
		$("#createLanguageDialog").modal("hide");
		ricottaAPI.loadLanguages(function(languages) {
			populateLanguages(languages);
		});
	}
	
	$(function() {
	    var langCode = $("#langCode"),
	        langName = $("#langName"),
	        allFields = $([]).add(langCode).add(langName),
	        tips = $( ".validateTips" );
	
	    /*
	    $("#createLanguageDialog").dialog({
	        autoOpen: false,
	        height: 500,
	        width: 700,
	        modal: true,
	        title: "Enter the new language's details",
	        buttons: {
	            Cancel: function() {
	                $( this ).dialog("close");
	            },
	            "Create language": function() {
	                var bValid = true;
	                allFields.removeClass("ui-state-error");
	                bValid = bValid && checkLength(langCode, "language code", 2, 7);
	                bValid = bValid && checkLength(langName, "language name", 4, 32);
	
	                if (bValid) {
	                	var data = {
	                        langCode: langCode.val(),
	                        name: langName.val()
	                    }
	                	ricottaAPI.createLanguage(data, loadLanguages, updateTips);
	                }
	                
	            }
	        },
	        close: function() {
	            allFields.val( "" ).removeClass( "ui-state-error" );
	        },
	        open: function() {
	            updateTips("All form fields are required.");
	        }
	    });
	    
	    $("#createLanguageButton").button().click(function() {
	        $("#createLanguageDialog").dialog("open");
	    });*/
	    $("#createLanguageDialog").modal({show:false});
	    
	    $("#createLanguageDialog").find("a.btn-success").click(function(){
	    	var bValid = true;
            allFields.removeClass("ui-state-error");
            bValid = bValid && checkLength(langCode, "language code", 2, 7);
            bValid = bValid && checkLength(langName, "language name", 4, 32);

            if (bValid) {
            	var data = {
                    langCode: langCode.val(),
                    name: langName.val()
                }
            	ricottaAPI.createLanguage(data, loadLanguages, updateTips);
            }
	    });
	
	    loadLanguages();
	});
	</script>
</div>

