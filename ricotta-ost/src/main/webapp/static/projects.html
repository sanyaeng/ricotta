<div class="projects">
	<table id="projects" class="table table-striped table-bordered">
	    <thead>
	        <tr>
	            <th>Project Name</th><th>Owner</th>
	        </tr>
	    </thead>
	    <tbody id="projectsBody"></tbody>
	    <tfoot>
	    </tfoot>
	</table>
	<a data-toggle="modal" href="#createProjectDialog" class="btn btn-primary">Create new project...</a>
	
	<!-- using modal instead  -->
	<div id="createProjectDialog" class="modal hide fade in" style="display: none;">
		<div class="modal-header">  
			<a class="close" data-dismiss="modal">Ã—</a>
			<h3>Create new project</h3>
		</div> 
		<div class="modal-body">
			 <p class="validateTips"></p>
		    <form>
		        <fieldset>
		            <label for="projName">Project name</label>
		            <input id="projName" name="projName"  class="text ui-widget-content ui-corner-all" />
		        </fieldset>
		        <fieldset>
		        	<label for="defaultLang">Default Language</label>
		            <select id="defaultLang"></select>
		        </fieldset>
		    </form>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn btn-success">Create Project</a>
			<a href="#" class="btn" data-dismiss="modal">Close</a>
		</div>
	</div>
	<!-- <button id="createProjectButton" >Create new project...</button> -->
	<!-- 
	<div id="createProjectDialog">
	    <p class="validateTips"></p>
	    <form>
	        <fieldset>
	            <label for="projName">Project name</label>
	            <input id="projName" name="projName"  class="text ui-widget-content ui-corner-all" />
	        </fieldset>
	        <fieldset>
	        	<label for="defaultLang">Default Language</label>
	            <select id="defaultLang"></select>
	        </fieldset>
	    </form>
	</div>  -->
	
	<script type="text/javascript">
	
	function populateProjects(data) {
		//$("#createProjectDialog").dialog("close"); //close the dialog if it's opened
		$("#createProjectDialog").modal("hide");
	    $("#projectsBody").empty();
	    $.map(data, function(p, i) {
	        $("#projectsBody")
	        .append(
	        		$("<tr id=\"projectTR" + p.name + "\">")
	        		.append("<td class=\"link\" onClick=\"loadProject('" + p.name + "');\">" + p.name + "</td>")
	                .append("<td>" + p.owner + "</td>")
	         );
	        $("#projectTR" + p.name).data("json", p);
	    });
	}
	
	function loadProject(projectName) {
	    // copy json from table to header
	    var p = $("#projectTR" + projectName).data("json");
	    $("#headerProject").data("project", p);
	    
	    // load project contents
	//    showToast("Loading " + projectName + "...");
	    //$("#contents").load("project.html");
	    $("#ricotta_contents").html("Loading...").load("project.html");
	}
	
	function populateLanguage() {
		ricottaAPI.loadLanguages(function(languages) {
			$.map(languages, function(l, i){
				$("#defaultLang").append("<option value='"+ l.code +"'>" + l.name + "</option>");
			})
		});
	}
	
	$(function() {
	    // clear project name
	    //$("#headerProject").text("");
		//load language to the new project dropdown
		populateLanguage();
		
	    var projName = $("#projName"),
	        allFields = $([]).add(projName),
	        tips = $(".validateTips");
		$("#createProjectDialog").find("a.btn-success").click(function() {
			var bValid = true;
	        allFields.removeClass("ui-state-error");
	        bValid = bValid && checkLength(projName, "project name", 4, 16);

	        if (bValid) {
	        	var projectName = projName.val();
	        	var defaultLang = $("#defaultLang option:selected").val();
	        	ricottaAPI.createProject(projectName, defaultLang, populateProjects, updateTips);
	        }
		});
	    /*
	    $("#createProjectDialog").dialog({
	        autoOpen: false,
	        height: 500,
	        width: 500,
	        modal: true,
	        title: "Enter the new project's name",
	        buttons: {
	            Cancel: function() {
	                $( this ).dialog("close");
	            },
	            "Create project": function() {
	                var bValid = true;
	                allFields.removeClass("ui-state-error");
	                bValid = bValid && checkLength(projName, "project name", 4, 16);
	
	                if (bValid) {
	                	var projectName = projName.val();
	                	var defaultLang = $("#defaultLang option:selected").val();
	                	ricottaAPI.createProject(projectName, defaultLang, populateProjects, updateTips);
	                }
	                
	            }
	        },
	        close: function() {
	            allFields.val( "" ).removeClass( "ui-state-error" );
	        },
	        open: function() {
	            updateTips("All form fields are required.");
	        }
	    });
	    
	    $("#createProjectButton").button().click(function() {
	        $("#createProjectDialog").dialog("open");
	    });*/
		$("#createProjectDialog").modal({show:false});
	   
	    //retrieve all project
		ricottaAPI.getProjects(populateProjects);
	            
	});
	
	/*
	function createNewProject() {
		var bValid = true;
        allFields.removeClass("ui-state-error");
        bValid = bValid && checkLength(projName, "project name", 4, 16);

        if (bValid) {
        	var projectName = projName.val();
        	var defaultLang = $("#defaultLang option:selected").val();
        	ricottaAPI.createProject(projectName, defaultLang, populateProjects, updateTips);
        }
	}*/
	</script>
</div>
